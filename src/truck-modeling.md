# Truck Modeling

## Overview

Module Guide
Converts analytic geometry and wires into shells and solids using sweep-based operators (extrude, revolve, loft), maintaining a consistent mapping between geometry and topology layers.

Crate: truck-modeling Inputs: truck-geometry curves/surfaces, truck-topology wires Outputs: shell/solid structures for booleans & tessellation
## 1. Modeling stack

Modeling sits above geometry but below booleans: it produces watertight shells that `truck-shapeops` and `truck-meshalgo` consume.

- **Geometry** – curves/surfaces from `truck-geometry`.
- **Topology** – vertices/edges/wires/faces from `truck-topology`.
- **Modeling** – orchestrates surfaces + trims + new topology (faces, shells).

The crate provides high-level APIs to create solids from wire profiles and reference surfaces, tracking orientation and parameterization throughout.

## 2. Sweep operators

### 2.1 Extrude

Extrusion takes planar wires and moves them along a vector:

- Generates ruled side faces by lofting between the source curve and its translated copy.
- Optionally caps the start/end with planar faces if the wire is closed.
- Records how each edge maps to new edges (generator, offset, rails) for downstream operations.

### 2.2 Revolve

Revolves a profile around an axis:

- Handles angular spans > 2π by splitting faces into non-overlapping regions.
- Detects axis intersections to avoid degeneracies (e.g., when a profile touches the axis).
- Aligns trimmed regions with parameter space so tessellation and booleans remain stable.

### 2.3 Sweep-along-path

Generalizes sweeps along arbitrary guide curves. The operator:

- Transport frames along the path (Frenet or custom frame) to orient cross-sections.
- Keeps edges paired with their offset copies for consistent topology mapping.
- Supports multi-section lofts (e.g., morphing between two profiles).

## 3. Face generation

### 3.1 Wires to faces

The modeling layer turns wires into trimmed faces:

1. Select a support surface (planar, lofted, swept).
2. Use the wire as the outer loop, with optional inner loops for holes.
3. Attach the face to the shell, respecting orientation.

This mirrors the B-rep definitions from `truck-topology`, ensuring compatibility.

### 3.2 Edge propagation

Every sweep tracks edge provenance:

- Original edge → generator edge on the face.
- Translated edge → offset edge.
- Connecting rails close the loop.

This mapping allows booleans and fillets to understand how new geometry derives from existing edges.

### 3.3 Trim management

Trim curves are stored in surface parameter space. Modeling ensures:

- Loops are properly oriented (outer loops CCW, inner loops CW in UV space).
- Edges carry both 3D curves and UV curves for trimming operations.
- Faces reference their trimming data for tessellation and intersection.

## 4. Shells & solids

Once faces are built, they are sewn into shells with consistent normals. Modeling can:

- Build closed shells from a sweep (e.g., extruded solids, revolved bodies).
- Generate multiple shells (outer + inner) for cavities.
- Produce solids (collections of shells) ready for booleans or meshing.

## 5. Integration with topology & booleans

- Faces, edges, and vertices produced here comply with `truck-topology` ’s orientation rules.
- Booleans (`truck-shapeops`) expect shells created by modeling; modeling’s metadata about edge provenance aids classification.
- Tessellation (`truck-meshalgo`) relies on trimmed surfaces created here for UV sampling.

## 6. Example scripts

The repository contains reference scripts showcasing how to assemble solids:

- **bottle** – replicates OCCT’s bottle tutorial using sweeps and revolutions.
- **cube / cylinder / sphere** – canonical primitives built via sweeps.
- **punched-cube / torus-punched-cube** – combines sweeps to make multi-shell solids.
- **tsudumi** – hyperboloid modeling example.

Each script outputs JSON that `truck-rendimpl` examples can visualize.

## 7. Best practices

- **Orientation** – wires should be consistently oriented before sweeping; use the `Invertible` trait to flip as needed.
- **Parameter continuity** – ensure surfaces generated by sweeps have well-behaved parameterization to avoid UV artifacts.
- **Edge mapping** – store metadata linking new edges to source edges for use by booleans/fillets.
- **Tolerance** – use `truck-base::tolerance` when snapping or checking closure.

## 8. Summary

`truck-modeling` provides the high-level operators needed to construct solids from wires and surfaces:

- Sweep operators (extrude, revolve, sweep-along-path).
- Face generation with trim management.
- Shell/solid assembly ready for booleans and tessellation.

Mastering this layer is key to authoring parametric modeling operations within Truck.

## 9. Implementation checklist

- **Wires** – validate planarity/orientation before sweeping.
- **Surfaces** – choose the correct support surface (planar vs. loft vs. ruled) for each operation.
- **Trims** – ensure trim loops remain watertight in UV space.
- **Edge provenance** – record mapping from input edges to generated edges.
- **Testing** – cover simple cases (cube, cylinder) and complex ones (bottle) to guard against regressions.
- **Docs** – update README and this guide when adding new operators.
